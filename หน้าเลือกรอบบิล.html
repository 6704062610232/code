<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <title>Cozy Home Admin - Professional Billing 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        /* --- ‡∏ü‡∏≠‡∏ô‡∏ï‡πå Tahoma / Kanit / Sarabun --- */
        @import url('https://fonts.googleapis.com/css2?family=Sarabun:wght@400;700&family=Kanit:wght@300;400;500&display=swap');

        :root {
            --c1: #CCD5AE; --c2: #E9EDC9; --c3: #FEFAE0; --c4: #FAEDCD; --c5: #D4A373;
            --success: #588157; --danger: #E5989B; --info: #0288d1; --excel: #217346;
        }

        body { font-family: 'Tahoma', 'Kanit', sans-serif; background: var(--c3); margin: 0; padding: 20px; color: #333; }
        
        /* --- UI Admin ‡∏´‡∏ô‡πâ‡∏≤‡∏´‡∏•‡∏±‡∏Å --- */
        .card { background: white; border-radius: 16px; padding: 25px; margin-bottom: 20px; box-shadow: 0 4px 15px rgba(0,0,0,.08); }
        .card h3 { margin-top: 0; border-bottom: 2px solid var(--c2); padding-bottom: 10px; color: var(--c5); margin-bottom: 20px; }
        .billing-grid { display: grid; grid-template-columns: 2fr 1.2fr; gap: 20px; }
        @media (max-width: 1100px) { .billing-grid { grid-template-columns: 1fr; } }
        
        .config-box { display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 15px; background: #fafafa; padding: 20px; border-radius: 15px; border: 1px solid #eee; }
        .input-group { display: flex; flex-direction: column; gap: 5px; }
        .input-group label { font-size: 12px; font-weight: bold; color: #666; }
        .input-group input, .input-group select { padding: 10px; border-radius: 12px; border: 2px solid #edf2f7; font-size: 14px; outline: none; }

        .summary-card { background: #fffcf5; border: 2px dashed var(--c5); border-radius: 20px; padding: 20px; display: flex; flex-direction: column; justify-content: space-between; }
        .price-row { display: flex; justify-content: space-between; margin-bottom: 8px; font-size: 14px; border-bottom: 1px solid rgba(0,0,0,0.03); padding-bottom: 4px; }
        .total-row { border-top: 2px solid var(--c5); margin-top: 10px; padding-top: 10px; color: var(--success); font-weight: bold; font-size: 26px; text-align: right; }
        
        .btn-issue { width: 100%; padding: 16px; border: none; border-radius: 15px; background: var(--success); color: white; font-weight: bold; cursor: pointer; font-size: 18px; margin-top: 10px; }
        .btn-excel { width: 100%; padding: 12px; border: none; border-radius: 15px; background: var(--excel); color: white; font-weight: bold; cursor: pointer; font-size: 15px; margin-top: 10px; display: flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-print-all { width: 100%; padding: 14px; border: none; border-radius: 15px; background: #2d4739; color: white; font-weight: bold; cursor: pointer; font-size: 16px; margin-top: 10px; display: none; }

        .filter-bar { display: flex; gap: 10px; margin-bottom: 15px; }
        .filter-btn { padding: 8px 18px; border-radius: 20px; border: 1.5px solid var(--c5); background: white; cursor: pointer; font-weight: bold; color: var(--c5); transition: 0.3s; }
        .filter-btn.active { background: var(--c5); color: white; }
        
        .table-container { overflow-x: auto; border-radius: 15px; border: 1px solid #eee; }
        .table { width: 100%; border-collapse: collapse; font-size: 13px; min-width: 1000px; background: white; }
        .table th, .table td { padding: 10px; border: 1px solid #eee; text-align: center; }
        .table th { background: #f8f9fa; color: #777; font-size: 12px; }
        .floor-header { background: var(--c2) !important; text-align: left !important; font-weight: bold; padding-left: 20px !important; color: #555; }

        /* Status Badge */
        .status-badge { padding: 4px 10px; border-radius: 20px; font-weight: bold; font-size: 11px; }
        .status-unpaid { background: #fff3f3; color: #d32f2f; border: 1px solid #ffcdd2; }
        .status-paid { background: #f1f8e9; color: #388e3c; border: 1px solid #c8e6c9; }

        /* --- Modal Overlays --- */
        #modalOverlay, #excelPreviewOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 9999; backdrop-filter: blur(5px); }
        .modal-card { background: white; width: 95%; max-width: 1100px; height: 85vh; border-radius: 35px; display: flex; overflow: hidden; }
        
        .excel-card { background: white; width: 98%; height: 90vh; border-radius: 20px; display: flex; flex-direction: column; padding: 25px; box-sizing: border-box; }
        .excel-table-container { flex: 1; overflow: auto; border: 1px solid #bbb; margin-top: 15px; }
        .excel-table { width: 100%; border-collapse: collapse; font-size: 13px; }
        .excel-table th { background: #f2f2f2; position: sticky; top: 0; z-index: 10; border: 1px solid #aaa; padding: 10px; }
        .excel-table td { border: 1px solid #ccc; padding: 8px; text-align: center; }

        .modal-sidebar { width: 280px; background: #f8f9fa; border-right: 1px solid #eee; padding: 30px 20px; display: flex; flex-direction: column; gap: 8px; }
        .tab-btn { padding: 15px; border: none; border-radius: 15px; text-align: left; cursor: pointer; background: none; font-weight: bold; color: #666; display: flex; align-items: center; gap: 12px; }
        .tab-btn.active { background: var(--c5); color: white; }
        
        /* ‡∏õ‡∏∏‡πà‡∏°‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô */
        .btn-payment-action { 
            margin-top: 20px; padding: 15px; border-radius: 15px; border: none; 
            font-weight: bold; cursor: pointer; font-size: 15px; 
            display: flex; align-items: center; justify-content: center; gap: 10px;
            transition: 0.3s;
        }
        .btn-pay-confirm { background: var(--success); color: white; }
        .btn-pay-cancel { background: #666; color: white; }

        .modal-body { flex: 1; padding: 30px; overflow-y: auto; background: #f0f2f5; }
        .pane { display: none; }
        .pane.active { display: block; animation: fadeIn 0.3s; }

        .rounded-box { background: white; border-radius: 30px; padding: 35px; box-shadow: 0 10px 30px rgba(0,0,0,0.05); border: 1px solid #eef; }
        .meter-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 25px; margin-top: 10px; }
        .meter-card { background: #ffffff; padding: 25px; border-radius: 25px; border: 1.5px solid #f0f0f0; }
        .meter-card label { display: block; font-weight: bold; font-size: 15px; margin-bottom: 20px; color: #444; }
        .input-pill { width: 100%; padding: 14px; border-radius: 15px; border: 2px solid #edf2f7; font-size: 16px; font-weight: bold; outline: none; box-sizing: border-box; background: #f8fafc; margin-bottom: 10px; }

        /* ---------------------------------------------------------
           INVOICE STYLE
        --------------------------------------------------------- */
        .invoice-print-container {
            width: 210mm; height: 148mm; padding: 10mm 15mm; box-sizing: border-box; 
            background: white; position: relative; color: black; font-family: 'Sarabun', sans-serif;
            border: 1px solid #000; margin: 0 auto; line-height: 1.3; overflow: hidden; display: block;
        }
        .inv-header { text-align: center; position: relative; margin-bottom: 5px; }
        .inv-apt-name { font-size: 20px; font-weight: bold; margin: 0; }
        .inv-apt-addr { font-size: 11.5px; margin: 0; }
        .inv-room-no-big { position: absolute; top: -2mm; right: -2mm; font-size: 34px; font-weight: bold; }
        .inv-subject-text { text-align: center; font-size: 19px; text-decoration: underline; font-weight: bold; margin-top: 25px; margin-bottom: 10px; }
        .inv-table-header { width: 100%; border: 1.5px solid #000; border-collapse: collapse; }
        .inv-table-header td { border: 1.5px solid #000; padding: 6px 12px; font-size: 14px; vertical-align: top; }
        .inv-main-table { width: 100%; border: 1.5px solid #000; border-collapse: collapse; border-top: none; }
        .inv-main-table th { border: 1.5px solid #000; padding: 5px; font-size: 12px; background: #f2f2f2 !important; text-align: center; -webkit-print-color-adjust: exact; }
        .inv-main-table td { border: 1.5px solid #000; padding: 4px 8px; font-size: 13.5px; vertical-align: middle; height: 23px; }
        .inv-footer-table { width: 100%; border: 1.5px solid #000; border-collapse: collapse; border-top: none; }
        .inv-footer-table td { padding: 6px 12px; border: 1.5px solid #000; font-size: 13.5px; font-weight: bold; }
        .inv-note { font-size: 11px; margin-top: 8px; line-height: 1.4; }
        .inv-sign { margin-top: 15px; text-align: right; padding-right: 50px; font-size: 14.5px; }

        @media print {
            @page { size: A5 landscape; margin: 0; }
            html, body { margin: 0 !important; padding: 0 !important; background: white; visibility: hidden; }
            #print-area { visibility: visible; display: block !important; position: absolute; top: 0; left: 0; width: 100%; }
            #print-area * { visibility: visible; }
            .invoice-print-container { border: none !important; page-break-after: always; margin: 0; padding: 10mm 15mm; }
            #billing-admin-page, #modalOverlay, #excelPreviewOverlay, .card, button { display: none !important; }
        }
    </style>
</head>
<body>

<div id="print-area"></div>

<section id="billing-admin-page">
    <div class="card">
        <div class="billing-grid">
            <div>
                <h3>üí∏ ‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤‡πÅ‡∏•‡∏∞‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏ö‡∏¥‡∏•</h3>
                <div class="config-box">
                    <div class="input-group" style="grid-column: span 2;">
                        <label>üìÖ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡∏ó‡∏µ‡πà‡∏î‡∏≥‡πÄ‡∏ô‡∏¥‡∏ô‡∏Å‡∏≤‡∏£</label>
                        <select id="billMonthSelect" onchange="syncAllUI()"></select>
                    </div>
                    <div class="input-group"><label>üè¢ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á</label><input type="number" id="cfgRent" value="2600" oninput="syncAllUI()"></div>
                    <div class="input-group"><label>üíß ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥ (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</label><input type="number" id="cfgWater" value="19" oninput="syncAllUI()"></div>
                    <div class="input-group"><label>‚ö° ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü (‡∏ö‡∏≤‡∏ó/‡∏´‡∏ô‡πà‡∏ß‡∏¢)</label><input type="number" id="cfgElec" value="7" oninput="syncAllUI()"></div>
                    <div class="input-group"><label>üåê ‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï</label><input type="number" id="cfgNet" value="200" oninput="syncAllUI()"></div>
                    <div class="input-group"><label>üßπ ‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</label><input type="number" id="cfgSvc" value="500" oninput="syncAllUI()"></div>
                </div>
            </div>

            <div class="summary-card">
                <div>
                    <h4 style="margin:0 0 10px 0; color:var(--c5); border-bottom: 1px solid var(--c4); padding-bottom: 5px;">
                        ‡∏™‡∏£‡∏∏‡∏õ‡∏¢‡∏≠‡∏î‡πÄ‡∏ö‡∏∑‡πâ‡∏≠‡∏á‡∏ï‡πâ‡∏ô (<span class="show-month">...</span>)
                    </h4>
                    <div class="price-row"><span>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á:</span><b id="vRent">0</b></div>
                    <div class="price-row"><span>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥ (/‡∏´‡∏ô‡πà‡∏ß‡∏¢):</span><b id="vWater">0</b></div>
                    <div class="price-row"><span>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü (/‡∏´‡∏ô‡πà‡∏ß‡∏¢):</span><b id="vElec">0</b></div>
                    <div class="price-row"><span>‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï:</span><b id="vNet">0</b></div>
                    <div class="price-row"><span>‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á:</span><b id="vSvc">0</b></div>
                    <div class="total-row">‡∏ø <span id="vTotalFixed">0</span></div>
                </div>
                <button class="btn-issue" onclick="issueAllRoomsNow()">üöÄ ‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏• (‡∏£‡∏ß‡∏° 50 ‡∏´‡πâ‡∏≠‡∏á)</button>
                <button class="btn-excel" onclick="openExcelPreview()"><i class="fas fa-table"></i> üìä ‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≠‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• (Excel)</button>
                <button class="btn-print-all" id="printAllBtn" onclick="window.print()">üñ®Ô∏è ‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (PDF)</button>
            </div>
        </div>
    </div>

    <div class="card">
        <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:15px">
            <h3>üìã ‡∏£‡∏≤‡∏¢‡∏ä‡∏∑‡πà‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å‡πÅ‡∏•‡∏∞‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</h3>
            <div class="filter-bar">
                <button class="filter-btn active" onclick="setFloor('all')" id="fBtnAll">‡∏ó‡∏∏‡∏Å‡∏ä‡∏±‡πâ‡∏ô</button>
                <button class="filter-btn" onclick="setFloor(1)" id="fBtn1">‡∏ä‡∏±‡πâ‡∏ô 1</button>
                <button class="filter-btn" onclick="setFloor(2)" id="fBtn2">‡∏ä‡∏±‡πâ‡∏ô 2</button>
                <button class="filter-btn" onclick="setFloor(3)" id="fBtn3">‡∏ä‡∏±‡πâ‡∏ô 3</button>
                <button class="filter-btn" onclick="setFloor(4)" id="fBtn4">‡∏ä‡∏±‡πâ‡∏ô 4</button>
                <button class="filter-btn" onclick="setFloor(5)" id="fBtn5">‡∏ä‡∏±‡πâ‡∏ô 5</button>
            </div>
        </div>
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr><th>‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á</th><th>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</th><th>‡∏ô‡πâ‡∏≥ (‡∏´‡∏ô‡πà‡∏ß‡∏¢)</th><th>‡πÑ‡∏ü (‡∏´‡∏ô‡πà‡∏ß‡∏¢)</th><th>‡∏¢‡∏≠‡∏î‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th></tr>
                </thead>
                <tbody id="billingTableBody"></tbody>
            </table>
        </div>
    </div>
</section>

<!-- Modal ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á -->
<div id="modalOverlay">
    <div class="modal-card">
        <div class="modal-sidebar">
            <h2 id="mRoomId" style="font-size: 40px; margin:0">---</h2>
            <p id="mTenant" style="font-size:14px; color:#888;">---</p>
            
            <button class="tab-btn active" id="tabBtn1" onclick="changePane('pane1')"><i class="fas fa-file-invoice"></i> ‡∏û‡∏£‡∏µ‡∏ß‡∏¥‡∏ß‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</button>
            <button class="tab-btn" id="tabBtn2" onclick="changePane('pane2')"><i class="fas fa-plus-circle"></i> ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏©</button>
            <button class="tab-btn" id="tabBtn3" onclick="changePane('pane3')"><i class="fas fa-tachometer-alt"></i> ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå</button>

            <!-- ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏™‡πà‡∏ß‡∏ô‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà -->
            <button id="paymentBtn" class="btn-payment-action" onclick="togglePaymentStatus()">
                <i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞ (‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î)
            </button>

            <button onclick="closeModal()" style="margin-top:auto; padding:12px; border-radius:15px; border:none; background:#eee; cursor:pointer; font-weight:bold; color:#666;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á‡∏ô‡∏µ‡πâ</button>
        </div>
        <div class="modal-body">
            <div id="pane1" class="pane active">
                <div id="singlePreviewArea" style="transform: scale(0.85); transform-origin: top center;"></div>
            </div>
            <div id="pane2" class="pane">
                <div class="rounded-box">
                    <h3>‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏û‡∏¥‡πÄ‡∏®‡∏© (‡∏™‡πà‡∏ß‡∏ô‡∏•‡∏î/‡∏Ñ‡πà‡∏≤‡∏õ‡∏£‡∏±‡∏ö/‡∏≠‡∏∑‡πà‡∏ô‡πÜ)</h3>
                    <input type="text" id="exName" placeholder="‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ ‡πÄ‡∏ä‡πà‡∏ô ‡∏Ñ‡πà‡∏≤‡∏ó‡∏µ‡πà‡∏à‡∏≠‡∏î‡∏£‡∏ñ" class="input-pill">
                    <input type="number" id="exVal" placeholder="‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô" class="input-pill">
                    <button class="btn-issue" onclick="handleAddExtra()">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏•‡∏á‡πÉ‡∏ô‡∏ö‡∏¥‡∏•</button>
                </div>
            </div>
            <div id="pane3" class="pane">
                <div class="rounded-box">
                    <h3>üìü ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡πÄ‡∏•‡∏Ç‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå</h3>
                    <div class="meter-grid">
                        <div class="meter-card">
                            <label><i class="fas fa-bolt" style="color:#fbc02d"></i> ‡πÑ‡∏ü‡∏ü‡πâ‡∏≤ (‡∏à‡∏î‡πÉ‡∏´‡∏°‡πà)</label>
                            <input type="number" id="edE1" placeholder="‡πÄ‡∏•‡∏Ç‡πÄ‡∏Å‡πà‡∏≤" class="input-pill" style="border-style:dashed;">
                            <input type="number" id="edE2" placeholder="‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà" class="input-pill">
                        </div>
                        <div class="meter-card">
                            <label><i class="fas fa-tint" style="color:#03a9f4"></i> ‡∏ô‡πâ‡∏≥‡∏õ‡∏£‡∏∞‡∏õ‡∏≤ (‡∏à‡∏î‡πÉ‡∏´‡∏°‡πà)</label>
                            <input type="number" id="edW1" placeholder="‡πÄ‡∏•‡∏Ç‡πÄ‡∏Å‡πà‡∏≤" class="input-pill" style="border-style:dashed;">
                            <input type="number" id="edW2" placeholder="‡πÄ‡∏•‡∏Ç‡πÉ‡∏´‡∏°‡πà" class="input-pill">
                        </div>
                    </div>
                    <button class="btn-issue" style="margin-top:25px; background:var(--c5)" onclick="handleSaveMeter()">üíæ ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal ‡∏ï‡∏≤‡∏£‡∏≤‡∏á Excel (‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°) -->
<div id="excelPreviewOverlay">
    <div class="excel-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            <h2 style="margin:0;"><i class="fas fa-table" style="color:var(--excel)"></i> ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡πÄ‡∏ä‡πá‡∏Ñ‡∏¢‡∏≠‡∏î‡∏ö‡∏¥‡∏•‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô <span class="show-month">...</span></h2>
            <button onclick="document.getElementById('excelPreviewOverlay').style.display='none'" style="padding:10px 25px; border-radius:10px; cursor:pointer; font-weight:bold;">‡∏õ‡∏¥‡∏î‡∏´‡∏ô‡πâ‡∏≤‡∏ï‡πà‡∏≤‡∏á</button>
        </div>
        <div class="excel-table-container">
            <table class="excel-table">
                <thead>
                    <tr><th>‡∏ä‡∏±‡πâ‡∏ô</th><th>‡πÄ‡∏•‡∏Ç‡∏´‡πâ‡∏≠‡∏á</th><th>‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤</th><th>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</th><th>‡∏ô‡πâ‡∏≥(‡∏´‡∏ô‡πà‡∏ß‡∏¢)</th><th>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥</th><th>‡πÑ‡∏ü(‡∏´‡∏ô‡πà‡∏ß‡∏¢)</th><th>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</th><th>‡∏≠‡∏∑‡πà‡∏ô‡πÜ</th><th>‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</th></tr>
                </thead>
                <tbody id="excelTableBody"></tbody>
            </table>
        </div>
    </div>
</div>

<script>
    const thaiMonths = ['‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå','‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°','‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô','‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°','‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô','‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°','‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°','‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô','‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°','‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô','‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°'];
    let rooms = [];
    let currentFloorFilter = 'all';
    let activeId = null;

    function thaiBaht(Number) {
        Number = Number.toFixed(2).split(".");
        const txtNum = ['‡∏®‡∏π‡∏ô‡∏¢‡πå','‡∏´‡∏ô‡∏∂‡πà‡∏á','‡∏™‡∏≠‡∏á','‡∏™‡∏≤‡∏°','‡∏™‡∏µ‡πà','‡∏´‡πâ‡∏≤','‡∏´‡∏Å','‡πÄ‡∏à‡πá‡∏î','‡πÅ‡∏õ‡∏î','‡πÄ‡∏Å‡πâ‡∏≤'];
        const txtWeight = ['','‡∏™‡∏¥‡∏ö','‡∏£‡πâ‡∏≠‡∏¢','‡∏û‡∏±‡∏ô','‡∏´‡∏°‡∏∑‡πà‡∏ô','‡πÅ‡∏™‡∏ô','‡∏•‡πâ‡∏≤‡∏ô'];
        let res = "";
        if(Number[0].length > 7) return "‡∏à‡∏≥‡∏ô‡∏ß‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏π‡∏á‡πÄ‡∏Å‡∏¥‡∏ô‡πÑ‡∏õ";
        for(let i=0; i<Number[0].length; i++) {
            let n = Number[0].charAt(i);
            if(n != 0) {
                if(i == (Number[0].length-1) && n == 1 && Number[0].length > 1) res += "‡πÄ‡∏≠‡πá‡∏î";
                else if(i == (Number[0].length-2) && n == 2) res += "‡∏¢‡∏µ‡πà‡∏™‡∏¥‡∏ö";
                else if(i == (Number[0].length-2) && n == 1) res += "‡∏™‡∏¥‡∏ö";
                else res += txtNum[n] + txtWeight[Number[0].length - i - 1];
            }
        }
        res += "‡∏ö‡∏≤‡∏ó‡∏ñ‡πâ‡∏ß‡∏ô";
        return res;
    }

    function init() {
        rooms = [];
        for(let f=1; f<=5; f++) {
            for(let r=1; r<=10; r++) {
                let id = f * 100 + r; 
                rooms.push({
                    id: id, floor: f, tenant: "‡∏Ñ‡∏∏‡∏ì‡∏õ‡∏£‡∏∞‡πÄ‡∏™‡∏£‡∏¥‡∏ê ‡∏™‡∏¥‡∏£‡∏¥‡∏Å‡∏ß‡∏¥‡∏ô‡∏ß‡∏á‡∏®‡πå",
                    addr: "23/55 ‡∏´‡∏°‡∏π‡πà 9 ‡∏ï.‡∏ö‡∏≤‡∏á‡πÇ‡∏ï‡∏ô‡∏î ‡∏≠.‡πÄ‡∏°‡∏∑‡∏≠‡∏á ‡∏à.‡∏ö‡∏∏‡∏£‡∏µ‡∏£‡∏±‡∏°‡∏¢‡πå",
                    e1: 5743, e2: 5850 + Math.floor(Math.random()*100), 
                    w1: 699, w2: 710 + Math.floor(Math.random()*15),
                    extras: [], isPaid: false
                });
            }
        }
        setupMonths(); syncAllUI();
    }

    function setupMonths() {
        const sel = document.getElementById('billMonthSelect');
        const now = new Date();
        for(let i=-1; i<=2; i++) {
            let d = new Date(now.getFullYear(), now.getMonth()+i, 1);
            let txt = `${thaiMonths[d.getMonth()]} ${d.getFullYear()+543}`;
            let opt = document.createElement('option');
            opt.value = txt; opt.text = txt;
            if(i===0) opt.selected = true;
            sel.appendChild(opt);
        }
    }

    function syncAllUI() {
        const month = document.getElementById('billMonthSelect').value;
        document.querySelectorAll('.show-month').forEach(el => el.innerText = month);
        const r = parseInt(document.getElementById('cfgRent').value) || 0;
        const w = parseInt(document.getElementById('cfgWater').value) || 0;
        const e = parseInt(document.getElementById('cfgElec').value) || 0;
        const n = parseInt(document.getElementById('cfgNet').value) || 0;
        const s = parseInt(document.getElementById('cfgSvc').value) || 0;
        document.getElementById('vRent').innerText = r.toLocaleString();
        document.getElementById('vWater').innerText = w.toLocaleString();
        document.getElementById('vElec').innerText = e.toLocaleString();
        document.getElementById('vNet').innerText = n.toLocaleString();
        document.getElementById('vSvc').innerText = s.toLocaleString();
        document.getElementById('vTotalFixed').innerText = (r + n + s).toLocaleString();
        renderTable();
    }

    function renderTable() {
        const tbody = document.getElementById('billingTableBody');
        tbody.innerHTML = '';
        const wR = parseInt(document.getElementById('cfgWater').value) || 0, eR = parseInt(document.getElementById('cfgElec').value) || 0;
        const fixed = (parseInt(document.getElementById('cfgRent').value) || 0) + (parseInt(document.getElementById('cfgNet').value) || 0) + (parseInt(document.getElementById('cfgSvc').value) || 0);
        const filtered = currentFloorFilter === 'all' ? rooms : rooms.filter(rm => rm.floor == currentFloorFilter);
        let lastFloor = 0;
        filtered.forEach(room => {
            if (room.floor !== lastFloor) {
                lastFloor = room.floor;
                tbody.innerHTML += `<tr><td colspan="7" class="floor-header">üè¢ ‡∏ä‡∏±‡πâ‡∏ô‡∏ó‡∏µ‡πà ${lastFloor}</td></tr>`;
            }
            const total = fixed + (room.w2-room.w1)*wR + (room.e2-room.e1)*eR + room.extras.reduce((s,i)=>s+i.val, 0);
            
            // ‡∏õ‡∏£‡∏±‡∏ö‡∏õ‡∏£‡∏∏‡∏á‡∏Å‡∏≤‡∏£‡πÅ‡∏™‡∏î‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞ Badge
            const statusHtml = room.isPaid 
                ? `<span class="status-badge status-paid"><i class="fas fa-check"></i> ‡∏ä‡∏≥‡∏£‡∏∞‡πÅ‡∏•‡πâ‡∏ß</span>`
                : `<span class="status-badge status-unpaid">‡∏£‡∏≠‡∏ä‡∏≥‡∏£‡∏∞</span>`;

            tbody.innerHTML += `<tr><td><b>${room.id}</b></td><td>${room.tenant}</td><td>${room.w2-room.w1} (${(room.w2-room.w1)*wR})</td><td>${room.e2-room.e1} (${(room.e2-room.e1)*eR})</td><td><b>${total.toLocaleString()}</b></td><td>${statusHtml}</td><td><button onclick="openManageRoom(${room.id})" style="background:none; border:none; color:var(--c5); cursor:pointer; font-size:18px;"><i class="fas fa-edit"></i></button></td></tr>`;
        });
    }

    function generateInvoiceHTML(r) {
        const monthYear = document.getElementById('billMonthSelect').value;
        const rR = parseInt(document.getElementById('cfgRent').value) || 0, wR = parseInt(document.getElementById('cfgWater').value) || 0, eR = parseInt(document.getElementById('cfgElec').value) || 0, nR = parseInt(document.getElementById('cfgNet').value) || 0, sR = parseInt(document.getElementById('cfgSvc').value) || 0;
        const total = rR + sR + nR + (r.e2-r.e1)*eR + (r.w2-r.w1)*wR + r.extras.reduce((s,i)=>s+i.val, 0);

        return `
        <div class="invoice-print-container">
            <div class="inv-header">
                <p class="inv-apt-name">Thai-C-Soft Apartment</p>
                <p class="inv-apt-addr">28/244 Moo 4 Phutthamonthon 4 Road, Sam Phran, Nakhon Pathom</p>
                <div class="inv-room-no-big">${r.id}</div>
            </div>
            <div class="inv-subject-text">‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ</div>
            <table class="inv-table-header">
                <tr><td width="65%">‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤ Name: &nbsp;&nbsp;&nbsp; <b>${r.tenant}</b><br><br>‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà Address: &nbsp;&nbsp;&nbsp; ${r.addr}</td><td>‡πÄ‡∏•‡∏Ç‡∏ó‡∏µ‡πà No. &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; IPD-0${r.id}<br><hr>‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà Date &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; 01/${monthYear}</td></tr>
            </table>
            <table class="inv-main-table">
                <thead><tr><th width="8%">Item</th><th width="45%">‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£ Description</th><th width="12%">Qty</th><th width="15%">Unit Price</th><th width="20%">Amount</th></tr></thead>
                <tbody>
                    <tr><td align="center">1</td><td>‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü ( ${r.e1} - ${r.e2} )</td><td align="center">${r.e2-r.e1}</td><td align="right">${eR.toFixed(2)}</td><td align="right">${((r.e2-r.e1)*eR).toLocaleString(undefined,{minimumFractionDigits:2})}</td></tr>
                    <tr><td align="center">2</td><td>‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥ ( ${r.w1} - ${r.w2} )</td><td align="center">${r.w2-r.w1}</td><td align="right">${wR.toFixed(2)}</td><td align="right">${((r.w2-r.w1)*wR).toLocaleString(undefined,{minimumFractionDigits:2})}</td></tr>
                    <tr><td align="center">3</td><td>‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏û‡∏±‡∏Å ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${monthYear.split(' ')[0]}</td><td align="center">1</td><td align="right">${rR.toFixed(2)}</td><td align="right">${rR.toLocaleString(undefined,{minimumFractionDigits:2})}</td></tr>
                    <tr><td align="center">4</td><td>‡∏Ñ‡πà‡∏≤‡∏≠‡∏¥‡∏ô‡πÄ‡∏ó‡∏≠‡∏£‡πå‡πÄ‡∏ô‡πá‡∏ï + ‡∏Ñ‡πà‡∏≤‡∏™‡πà‡∏ß‡∏ô‡∏Å‡∏•‡∏≤‡∏á</td><td align="center">1</td><td align="right">${(nR+sR).toFixed(2)}</td><td align="right">${(nR+sR).toLocaleString(undefined,{minimumFractionDigits:2})}</td></tr>
                    ${r.extras.map((ex, idx) => `<tr><td align="center">${idx+5}</td><td>${ex.name}</td><td align="center">1</td><td align="right">${ex.val.toFixed(2)}</td><td align="right">${ex.val.toLocaleString(undefined,{minimumFractionDigits:2})}</td></tr>`).join('')}
                    <tr><td></td><td></td><td></td><td></td><td></td></tr>
                </tbody>
            </table>
            <table class="inv-footer-table">
                <tr><td width="70%" align="center">(${thaiBaht(total)})</td><td width="30%" align="right">‡∏£‡∏ß‡∏°: &nbsp;&nbsp; <b>${total.toLocaleString(undefined,{minimumFractionDigits:2})}</b></td></tr>
            </table>
            <div class="inv-note">
                <b>‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</b> 1. ‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏Ç‡πâ‡∏≤‡∏ö‡∏±‡∏ç‡∏ä‡∏µ "‡∏ô‡∏≤‡∏¢ ‡∏à‡∏¥‡∏ï‡∏ï‡∏¥‡∏®‡∏±‡∏Å‡∏î‡∏¥‡πå ‡∏û‡∏¥‡∏°‡∏û‡πå‡∏ô‡∏ô‡∏ó‡πå" ‡πÅ‡∏•‡∏∞‡πÅ‡∏à‡πâ‡∏á‡∏™‡∏•‡∏¥‡∏õ‡∏ó‡∏µ‡πà‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏£‡∏≤‡∏ö<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;- ‡∏ò.‡∏Å‡∏™‡∏¥‡∏Å‡∏£‡πÑ‡∏ó‡∏¢ XXX-XXXXXX-X / ‡∏ò.‡πÑ‡∏ó‡∏¢‡∏û‡∏≤‡∏ì‡∏¥‡∏ä‡∏¢‡πå XXX-X-XXXXX-X<br>
                &nbsp;&nbsp;&nbsp;&nbsp; 2. ‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà 5 ‡∏Ç‡∏≠‡∏á‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Å‡∏≥‡∏´‡∏ô‡∏î‡∏õ‡∏£‡∏±‡∏ö‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 100 ‡∏ö‡∏≤‡∏ó
            </div>
            <div class="inv-sign">‡∏•‡∏á‡∏ä‡∏∑‡πà‡∏≠ ______________________________ ‡∏ú‡∏π‡πâ‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô</div>
        </div>`;
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡∏™‡∏•‡∏±‡∏ö‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô
    function togglePaymentStatus() {
        const r = rooms.find(rm => rm.id == activeId);
        r.isPaid = !r.isPaid;
        
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï UI ‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ó‡∏±‡∏ô‡∏ó‡∏µ
        updatePaymentButtonUI(r.isPaid);
        // ‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏´‡∏•‡∏±‡∏Å
        renderTable();

        if(r.isPaid) {
            alert(`‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î ‡∏´‡πâ‡∏≠‡∏á ${r.id} ‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!`);
        }
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô ‡∏õ‡∏£‡∏±‡∏ö‡πÅ‡∏ï‡πà‡∏á‡∏™‡∏µ‡πÅ‡∏•‡∏∞‡∏Ç‡πâ‡∏≠‡∏Ñ‡∏ß‡∏≤‡∏°‡∏Ç‡∏≠‡∏á‡∏õ‡∏∏‡πà‡∏°‡∏ï‡∏≤‡∏°‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞
    function updatePaymentButtonUI(isPaid) {
        const btn = document.getElementById('paymentBtn');
        if(isPaid) {
            btn.innerHTML = `<i class="fas fa-undo"></i> ‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏±‡∏ö‡πÄ‡∏á‡∏¥‡∏ô (‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞)`;
            btn.className = "btn-payment-action btn-pay-cancel";
        } else {
            btn.innerHTML = `<i class="fas fa-check-circle"></i> ‡∏¢‡∏∑‡∏ô‡∏¢‡∏±‡∏ô‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞ (‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î)`;
            btn.className = "btn-payment-action btn-pay-confirm";
        }
    }

    function openManageRoom(id) {
        activeId = id; const r = rooms.find(rm => rm.id == id);
        document.getElementById('mRoomId').innerText = r.id;
        document.getElementById('mTenant').innerText = "‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤: " + r.tenant;
        document.getElementById('edE1').value = r.e1; document.getElementById('edE2').value = r.e2;
        document.getElementById('edW1').value = r.w1; document.getElementById('edW2').value = r.w2;
        
        // ‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏Å‡∏≤‡∏£‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏µ‡∏õ‡∏∏‡πà‡∏°
        updatePaymentButtonUI(r.isPaid);

        refreshModal(); 
        document.getElementById('modalOverlay').style.display = 'flex';
    }

    // ‡∏ü‡∏±‡∏á‡∏Å‡πå‡∏ä‡∏±‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡πÜ ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡πÄ‡∏î‡∏¥‡∏°...
    function issueAllRoomsNow() {
        const area = document.getElementById('print-area'); area.innerHTML = '';
        rooms.forEach(r => area.innerHTML += generateInvoiceHTML(r));
        alert('üöÄ ‡∏≠‡∏≠‡∏Å‡∏ö‡∏¥‡∏•‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à! ‡∏Ñ‡∏∏‡∏ì‡∏™‡∏≤‡∏°‡∏≤‡∏£‡∏ñ‡∏Å‡∏î‡∏õ‡∏∏‡πà‡∏° "‡∏û‡∏¥‡∏°‡∏û‡πå‡πÉ‡∏ö‡πÅ‡∏à‡πâ‡∏á‡∏´‡∏ô‡∏µ‡πâ‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î" ‡πÑ‡∏î‡πâ‡πÅ‡∏•‡πâ‡∏ß');
        document.getElementById('printAllBtn').style.display = 'block';
    }

    function refreshModal() {
        const r = rooms.find(rm => rm.id == activeId);
        document.getElementById('singlePreviewArea').innerHTML = generateInvoiceHTML(r);
    }

    function handleSaveMeter() {
        const r = rooms.find(rm => rm.id == activeId);
        r.e1 = parseInt(document.getElementById('edE1').value); r.e2 = parseInt(document.getElementById('edE2').value);
        r.w1 = parseInt(document.getElementById('edW1').value); r.w2 = parseInt(document.getElementById('edW2').value);
        refreshModal(); renderTable(); alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå‡πÅ‡∏•‡πâ‡∏ß');
    }

    function handleAddExtra() {
        const r = rooms.find(rm => rm.id == activeId);
        const name = document.getElementById('exName').value, val = parseInt(document.getElementById('exVal').value);
        if(name && val) { r.extras.push({name, val}); document.getElementById('exName').value = ''; document.getElementById('exVal').value = ''; refreshModal(); renderTable(); }
    }

    function openExcelPreview() {
        const tbody = document.getElementById('excelTableBody');
        tbody.innerHTML = '';
        const wR = parseInt(document.getElementById('cfgWater').value) || 0, eR = parseInt(document.getElementById('cfgElec').value) || 0, rent = parseInt(document.getElementById('cfgRent').value) || 0;
        const other = (parseInt(document.getElementById('cfgNet').value) || 0) + (parseInt(document.getElementById('cfgSvc').value) || 0);
        rooms.forEach(r => {
            const sum = rent + other + (r.w2-r.w1)*wR + (r.e2-r.e1)*eR + r.extras.reduce((s,i)=>s+i.val, 0);
            tbody.innerHTML += `<tr><td>${r.floor}</td><td>${r.id}</td><td>${r.tenant}</td><td>${rent}</td><td>${r.w2-r.w1}</td><td>${(r.w2-r.w1)*wR}</td><td>${r.e2-r.e1}</td><td>${(r.e2-r.e1)*eR}</td><td>${other}</td><td><b>${sum.toLocaleString()}</b></td></tr>`;
        });
        document.getElementById('excelPreviewOverlay').style.display = 'flex';
    }

    function setFloor(f) { currentFloorFilter = f; renderTable(); }
    function closeModal() { document.getElementById('modalOverlay').style.display = 'none'; }
    function changePane(id) {
        document.querySelectorAll('.pane').forEach(p => p.classList.remove('active'));
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('tabBtn' + id.slice(-1)).classList.add('active');
    }

    init();
</script>
</body>
</html>