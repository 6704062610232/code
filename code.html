<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<title>Cozy Home ‚Äì ‡∏£‡∏∞‡∏ö‡∏ö‡∏´‡∏≠‡∏û‡∏±‡∏Å</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
:root{
  --c1:#CCD5AE; --c2:#E9EDC9; --c3:#FEFAE0; --c4:#FAEDCD; --c5:#D4A373;
}
*{box-sizing:border-box;font-family:'Segoe UI',sans-serif;}
body{margin:0;background:#fff;color:#333;}
.topbar{height:56px;background:var(--c5);display:flex;align-items:center;justify-content:space-between;padding:0 20px;color:#fff;}
.topbar .left{font-weight:700;font-size:18px;}
.topbar .right{display:flex;gap:16px;align-items:center;}
.topbar .icon{width:32px;height:32px;border-radius:8px;background:rgba(255,255,255,.25);display:flex;align-items:center;justify-content:center;font-size:14px;cursor:pointer;}
.wrapper{padding:24px;background:#e6e6e6;min-height:calc(100vh - 56px);}
.page{background:#fff;border-radius:10px;padding:20px;display:none;}
.page h2{text-align:center;margin-top:0;}
.tabs{display:flex;border-radius:8px;overflow:hidden;margin-bottom:14px;}
.tab{flex:1;text-align:center;padding:10px;font-weight:600;cursor:pointer;opacity:.4;}
.tab.active{opacity:1;}
.tab.water{background:#4fc3f7;color:#fff;}
.tab.electric{background:#ef5350;color:#fff;}
.table{width:100%;border-collapse:collapse;}
.table th,.table td{padding:10px;border-bottom:1px solid #eee;text-align:center;}
.table th{background:#f3f3f3;}
.input-lite{background:#dff3f3;border:1px solid #b7e1e1;border-radius:4px;padding:4px 6px;}
.bill-grid{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-top:16px;}
.bill-card{border-radius:12px;padding:14px;text-align:center;background:#7cb342;color:#fff;cursor:pointer;position:relative;}
.bill-card.red{background:#ef5350;}
.bill-card.gray{background:#ccc;color:#555;cursor:default;}
.receipt{position:absolute;background:#fff;border:1px solid #ddd;border-radius:8px;padding:12px;width:180px;font-size:12px;display:none;z-index:10;}
.chart-container{border:1px solid #eee;border-radius:12px;padding:14px;margin-bottom:20px;background:#fff;}
.chart-title{text-align:center;margin-top:0;margin-bottom:10px;}
.data-row{display:flex;justify-content:flex-start;align-items:center;margin:4px 0;gap:6px;}
.data-row button{width:16px;height:16px;border:none;margin:0;vertical-align:middle;}
.value{margin-left:auto;text-align:right;flex:0 0 100px;}
</style>
</head>
<body>

<!-- LOGIN -->
<div id="loginPage" style="position:fixed;inset:0;background:#fff;display:flex;align-items:center;justify-content:center;z-index:9999;">
  <div style="width:360px;border:1px solid #eee;border-radius:12px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.08);">
    <h2 style="text-align:center;margin-top:0;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</h2>
    <label>‡∏≠‡∏µ‡πÄ‡∏°‡∏•</label>
    <input id="email" type="email" placeholder="example@email.com" style="width:100%;padding:10px;margin:6px 0 12px;border-radius:8px;border:1px solid #ccc;">
    <label>‡∏£‡∏´‡∏±‡∏™‡∏ú‡πà‡∏≤‡∏ô</label>
    <input id="password" type="password" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" style="width:100%;padding:10px;margin:6px 0 16px;border-radius:8px;border:1px solid #ccc;">
    <button onclick="login()" style="width:100%;padding:10px;border:none;border-radius:8px;background:var(--c5);color:#fff;font-size:16px;">‡πÄ‡∏Ç‡πâ‡∏≤‡∏™‡∏π‡πà‡∏£‡∏∞‡∏ö‡∏ö</button>
    <p style="text-align:center;font-size:13px;color:#777;margin-top:12px;">Demo Login</p>
  </div>
</div>

<div class="topbar">
  <div class="left">Cozy Home</div>
  <div class="right">
    <div class="icon" onclick="showPage(0)">üè¢</div>
    <div class="icon" onclick="showPage(1)">üìÑ</div>
    <div class="icon" onclick="showPage(2)">üìä</div>
    <div class="icon">Nicha</div>
    <div class="icon" onclick="logout()">üè†</div>
  </div>
</div>

<div class="wrapper">

<!-- PAGE 1 : ‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå -->
<div class="page" id="pageMeter">
<h2>‡∏à‡∏î‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå</h2>
<div class="tabs">
  <div class="tab water active" onclick="switchTab(this)">üíß ‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥</div>
  <div class="tab electric" onclick="switchTab(this)">‚ö° ‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü</div>
</div>
<div id="meterContainer"></div>
</div>

<!-- PAGE 2 : ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏ö‡∏¥‡∏• -->
<div class="page" id="pageBill" style="position:relative;">
<h2>‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏ö‡∏¥‡∏•</h2>
<div style="display:flex;justify-content:flex-end;align-items:center;margin-bottom:12px;">
  <input type="month" value="2025-12" style="padding:6px 10px;border-radius:6px;border:1px solid #ccc;">
</div>
<div id="billContainer"></div>
<div class="receipt" id="billPreview">
  <b>‡πÅ‡∏à‡πâ‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡πÄ‡∏á‡∏¥‡∏ô</b><br><br>
  <p>‡∏´‡πâ‡∏≠‡∏á <b><span id="billRoom"></span></b></p>
  <p>‡∏¢‡∏≠‡∏î‡∏ó‡∏µ‡πà‡∏ï‡πâ‡∏≠‡∏á‡∏ä‡∏≥‡∏£‡∏∞ <b><span id="billAmount">-</span></b></p>
  <p>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞: <b id="billStatus">-</b></p>
</div>
</div>

<!-- PAGE 3 : ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö -->
<div class="page" id="pageAnalysis">
  <div class="chart-container">
    <h2 class="chart-title">‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
    <div style="display:flex;align-items:flex-start;gap:20px;">
      <canvas id="paymentPie" width="250" height="250"></canvas>
      <div style="flex:1; display:flex; flex-direction:column; gap:4px;">
        <div class="data-row"><button style="background:#7cb342"></button><span>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß</span><span class="value" id="paidAmount">0 ‡∏ö‡∏≤‡∏ó</span></div>
        <div class="data-row"><button style="background:#4fc3f7"></button><span>‡∏ä‡∏≥‡∏£‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î</span><span class="value" id="cashAmount">0 ‡∏ö‡∏≤‡∏ó</span></div>
        <div class="data-row"><button style="background:#ffd54f"></button><span>‡∏ä‡∏≥‡∏£‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô</span><span class="value" id="transferAmount">0 ‡∏ö‡∏≤‡∏ó</span></div>
        <div class="data-row"><button style="background:#ef5350"></button><span>‡∏ä‡∏≥‡∏£‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï/‡πÄ‡∏î‡∏ö‡∏¥‡∏ï</span><span class="value" id="cardAmount">0 ‡∏ö‡∏≤‡∏ó</span></div>
        <div class="data-row"><button style="background:#b0bec5"></button><span>‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤</span><span class="value" id="unpaidAmount">0 ‡∏ö‡∏≤‡∏ó</span></div>
        <hr>
        <div class="data-row"><span>‡∏£‡∏ß‡∏°‡∏™‡∏∏‡∏ó‡∏ò‡∏¥</span><span class="value" id="totalAmount">0 ‡∏ö‡∏≤‡∏ó</span></div>
      </div>
    </div>
  </div>

  <div class="chart-container">
    <h2 class="chart-title">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°/2025 - ‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°/2025</h2>
    <canvas id="monthlyBar" width="600" height="200"></canvas>
  </div>
</div>

</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
let roomData=[];

function login(){
  const email=document.getElementById('email').value;
  const pass=document.getElementById('password').value;
  if(email && pass){
    document.getElementById('loginPage').style.display='none';
    generateRoomData();
    showPage(0);
    initMeter();
    initBill();
    initAnalysis();
  } else alert('‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡∏Å‡∏£‡∏≠‡∏Å Email ‡πÅ‡∏•‡∏∞ Password');
}
function logout(){location.reload();}
function showPage(index){
  document.querySelectorAll('.page').forEach((p,i)=>p.style.display=i===index?'block':'none');
}

// ‡∏™‡∏£‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏´‡πâ‡∏≠‡∏á
function generateRoomData(){
  for(let f=1; f<=5; f++){
    roomData[f]=[];
    for(let r=1; r<=10; r++){
      let rand=Math.random(), status='‡∏õ‡∏Å‡∏ï‡∏¥';
      if(rand<0.15) status='‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞';
      else if(rand<0.3) status='‡∏ß‡πà‡∏≤‡∏á';
      const amount = status==='‡∏õ‡∏Å‡∏ï‡∏¥'? 3000 + Math.floor(Math.random()*1000) : status==='‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞'? 3500 : 0;
      const cash = status==='‡∏õ‡∏Å‡∏ï‡∏¥'? Math.floor(amount*0.3) : 0;
      const transfer = status==='‡∏õ‡∏Å‡∏ï‡∏¥'? Math.floor(amount*0.4) : 0;
      const card = status==='‡∏õ‡∏Å‡∏ï‡∏¥'? amount - cash - transfer : 0;
      const unpaid = status==='‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞'? amount : 0;
      roomData[f][r]={status, amount, cash, transfer, card, unpaid};
    }
  }
}

// ‡∏à‡∏î‡∏°‡∏¥‡πÄ‡∏ï‡∏≠‡∏£‡πå
function initMeter(){
  const container=document.getElementById('meterContainer');
  container.innerHTML='';
  for(let f=1; f<=5; f++){
    const floorDiv=document.createElement('div');
    floorDiv.innerHTML=`<h3>‡∏ä‡∏±‡πâ‡∏ô ${f}</h3>`;
    ['water','electric'].forEach(type=>{
      const tbl=document.createElement('table');
      tbl.className='table meterTable'; tbl.dataset.type=type;
      tbl.style.display=(type=='water')?'table':'none';
      let html=`<tr><th colspan="5">${type=='water'?'üíß ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥':'‚ö° ‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏Ñ‡πà‡∏≤‡πÑ‡∏ü'}</th></tr>
      <tr><th>‡∏´‡πâ‡∏≠‡∏á</th><th>‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞</th><th>‡πÄ‡∏•‡∏Ç‡∏Å‡πà‡∏≠‡∏ô‡∏´‡∏ô‡πâ‡∏≤</th><th>‡πÄ‡∏•‡∏Ç‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î</th><th>‡∏´‡∏ô‡πà‡∏ß‡∏¢‡πÉ‡∏ä‡πâ</th></tr>`;
      for(let r=1;r<=10;r++){
        const room=roomData[f][r];
        let statusIcon='üë§';
        if(room.status==='‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞') statusIcon='‚ùå';
        else if(room.status==='‡∏ß‡πà‡∏≤‡∏á') statusIcon='‚õî';
        let prev=Math.floor(Math.random()*(type=='water'?500:10000));
        let curr=prev+Math.floor(Math.random()*(type=='water'?100:500));
        let input=`<input class="input-lite" value="${curr}" ${room.status==='‡∏ß‡πà‡∏≤‡∏á'?'disabled':''} oninput="calcUnit(this)">`;
        html+=`<tr>
          <td>${f}0${r}</td>
          <td>${statusIcon}</td>
          <td>${prev}</td>
          <td>${input}</td>
          <td class="unit">${curr-prev}</td>
        </tr>`;
      }
      tbl.innerHTML=html;
      floorDiv.appendChild(tbl);
    });
    container.appendChild(floorDiv);
  }
}
function calcUnit(el){
  const tr=el.closest('tr');
  const prev=parseInt(tr.children[2].innerText);
  const curr=parseInt(el.value)||0;
  tr.querySelector('.unit').innerText=curr-prev;
}
function switchTab(t){
  document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
  t.classList.add('active');
  document.querySelectorAll('.meterTable').forEach(tbl=>{
    tbl.style.display=(t.classList.contains('water') && tbl.dataset.type=='water')||(t.classList.contains('electric') && tbl.dataset.type=='electric')?'table':'none';
  });
}

// ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≠‡∏ö‡∏ö‡∏¥‡∏•
function initBill(){
  const container=document.getElementById('billContainer'); container.innerHTML='';
  for(let f=1; f<=5; f++){
    const floorDiv=document.createElement('div'); floorDiv.innerHTML=`<h3>‡∏ä‡∏±‡πâ‡∏ô ${f}</h3>`;
    const grid=document.createElement('div'); grid.className='bill-grid';
    for(let r=1;r<=10;r++){
      const div=document.createElement('div'); const room=roomData[f][r];
      div.dataset.room=`${f}0${r}`; div.dataset.amount=room.amount; div.dataset.status=room.status;
      if(room.status==='‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞'){div.className='bill-card red';}
      else if(room.status==='‡∏ß‡πà‡∏≤‡∏á'){div.className='bill-card gray';}
      else{div.className='bill-card';}
      div.innerHTML=`<div class="room">${f}0${r}</div><div class="price">${room.status==='‡∏õ‡∏Å‡∏ï‡∏¥'?room.amount+' ‡∏ö‡∏≤‡∏ó':room.status}</div>`;
      
      div.onclick=function(e){
        if(this.dataset.status==='‡∏õ‡∏Å‡∏ï‡∏¥'||this.dataset.status==='‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞'){
          const preview = document.getElementById('billPreview');
          preview.style.display = 'block';
          const tdRoom = this.querySelector('.room') || this;
          const rect = tdRoom.getBoundingClientRect();
          // ‡∏™‡∏π‡∏á‡∏Ç‡∏∂‡πâ‡∏ô 100px ‡πÅ‡∏•‡∏∞‡∏ï‡∏£‡∏á‡∏Å‡∏•‡∏≤‡∏á‡∏ä‡πà‡∏≠‡∏á
          preview.style.top = rect.top + window.scrollY - 120 + 'px';
          preview.style.left = rect.left + window.scrollX + (rect.width/3) - (preview.offsetWidth/2.5) + 'px';
          document.getElementById('billRoom').innerText = this.dataset.room;
          document.getElementById('billAmount').innerText = this.dataset.amount + ' ‡∏ö‡∏≤‡∏ó';
          document.getElementById('billStatus').innerText = this.dataset.status;
        }
      };
      grid.appendChild(div);
    }
    floorDiv.appendChild(grid);
    container.appendChild(floorDiv);
  }
}

// ‡∏ß‡∏¥‡πÄ‡∏Ñ‡∏£‡∏≤‡∏∞‡∏´‡πå‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö
function initAnalysis(){
  const pieColors=['#7cb342','#4fc3f7','#ffd54f','#ef5350','#b0bec5'];
  const ctxPie=document.getElementById('paymentPie').getContext('2d');
  const ctxBar=document.getElementById('monthlyBar').getContext('2d');
  let pieData={labels:['‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤‡πÅ‡∏•‡πâ‡∏ß','‡∏ä‡∏≥‡∏£‡∏∞‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏á‡∏¥‡∏ô‡∏™‡∏î','‡∏ä‡∏≥‡∏£‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡∏Å‡∏≤‡∏£‡πÇ‡∏≠‡∏ô‡πÄ‡∏á‡∏¥‡∏ô','‡∏ä‡∏≥‡∏£‡∏∞‡∏ú‡πà‡∏≤‡∏ô‡∏ö‡∏±‡∏ï‡∏£‡πÄ‡∏Ñ‡∏£‡∏î‡∏¥‡∏ï/‡πÄ‡∏î‡∏ö‡∏¥‡∏ï','‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞‡∏Ñ‡πà‡∏≤‡πÄ‡∏ä‡πà‡∏≤'], datasets:[{data:[0,0,0,0,0], backgroundColor:pieColors}]};
  let chartPie=new Chart(ctxPie,{type:'pie',data:pieData,options:{plugins:{legend:{display:false}}}});
  let barLabels=['‡∏°.‡∏Ñ','‡∏Å.‡∏û','‡∏°‡∏µ.‡∏Ñ','‡πÄ‡∏°.‡∏¢','‡∏û.‡∏Ñ','‡∏°‡∏¥.‡∏¢','‡∏Å.‡∏Ñ','‡∏™.‡∏Ñ','‡∏Å.‡∏¢','‡∏ï.‡∏Ñ','‡∏û.‡∏¢','‡∏ò.‡∏Ñ'];
  let barData={labels:barLabels,datasets:[{label:'‡∏£‡∏≤‡∏¢‡∏£‡∏±‡∏ö (‡∏ö‡∏≤‡∏ó)',data:[],backgroundColor:'#7cb342'}]};
  let chartBar=new Chart(ctxBar,{type:'bar',data:barData,options:{plugins:{legend:{display:false}},scales:{y:{beginAtZero:true}},onClick:(e,el)=>{if(el.length>0) updatePie(el[0].index);}}});

  let monthlyData=[];
  for(let m=0;m<12;m++){
    let paidTotal=0, cashTotal=0, transferTotal=0, cardTotal=0, unpaidTotal=0;
    for(let f=1; f<=5; f++){
      for(let r=1; r<=10; r++){
        const d=roomData[f][r]; let factor=0.9+Math.random()*0.2;
        if(d.status==='‡∏õ‡∏Å‡∏ï‡∏¥'){let total=Math.floor((d.cash+d.transfer+d.card)*factor);
          paidTotal+=total; cashTotal+=Math.floor(d.cash*factor); transferTotal+=Math.floor(d.transfer*factor); cardTotal+=Math.floor(d.card*factor);}
        else if(d.status==='‡∏Ñ‡πâ‡∏≤‡∏á‡∏ä‡∏≥‡∏£‡∏∞'){unpaidTotal+=Math.floor(d.amount*factor);}
      }
    }
    monthlyData.push({paidTotal,cashTotal,transferTotal,cardTotal,unpaidTotal,total:paidTotal+unpaidTotal});
  }

  function updatePie(monthIndex){
    const data=monthlyData[monthIndex];
    chartPie.data.datasets[0].data=[data.paidTotal,data.cashTotal,data.transferTotal,data.cardTotal,data.unpaidTotal];
    chartPie.update();
    document.getElementById('paidAmount').innerText=data.paidTotal.toLocaleString()+' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('cashAmount').innerText=data.cashTotal.toLocaleString()+' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('transferAmount').innerText=data.transferTotal.toLocaleString()+' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('cardAmount').innerText=data.cardTotal.toLocaleString()+' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('unpaidAmount').innerText=data.unpaidTotal.toLocaleString()+' ‡∏ö‡∏≤‡∏ó';
    document.getElementById('totalAmount').innerText=data.total.toLocaleString()+' ‡∏ö‡∏≤‡∏ó';
  }

  barData.datasets[0].data=monthlyData.map(d=>d.total);
  chartBar.update();
  updatePie(11); // ‡πÄ‡∏£‡∏¥‡πà‡∏° ‡∏ò.‡∏Ñ
}
</script>
</body>
</html>
