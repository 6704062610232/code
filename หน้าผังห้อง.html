<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Cozy Home Admin - Multi-Tenant System</title>
<style>
:root{
 --c1:#CCD5AE; --c2:#E9EDC9; --c3:#FEFAE0; --c4:#FAEDCD; --c5:#D4A373;
 --occupied:#A3B18A; --vacant:#ffffff; --danger:#E5989B;
}
body{ margin:0; background:var(--c3); font-family: 'Segoe UI', Tahoma, sans-serif; padding: 20px; color: #333; }

/* Banner ‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á */
#move-banner { 
    display:none; background: var(--c5); color: white; padding: 15px; 
    text-align: center; position: fixed; top: 0; left:0; width: 100%; z-index: 9999; 
    font-weight: bold; box-shadow: 0 4px 15px rgba(0,0,0,0.3); 
}
#move-banner button { margin-left:15px; padding:6px 15px; border-radius:20px; border:none; cursor:pointer; background:white; color:var(--c5); font-weight:bold; }

/* --- ‡∏ú‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á (Grid) --- */
.card{ background:white; border-radius:24px; padding:25px; box-shadow:0 10px 30px rgba(0,0,0,.05); max-width: 1000px; margin: auto; }
.floor-row { display: flex; align-items: center; margin-bottom: 12px; background: rgba(255,255,255,0.6); border-radius: 35px; padding: 8px; border: 1px solid #f0f0f0; }
.floor-label { min-width: 70px; font-weight: bold; color: var(--c5); text-align: center; font-size: 13px; }
.room-container { display: flex; gap: 10px; overflow-x: auto; flex: 1; padding: 5px; }

.room-card { 
    min-width: 90px; height: 100px; border-radius: 25px; 
    display: flex; flex-direction: column; align-items: center; justify-content: center; 
    cursor: pointer; border: 2px dashed #ddd; background: var(--vacant); color: #bbb; transition: 0.2s;
}
.room-card.has-tenant { background: var(--occupied); color: white; border: none; }
.room-card b { font-size: 17px; }
.count-tag { font-size: 11px; margin-top: 4px; font-weight: bold; background: rgba(0,0,0,0.05); padding: 2px 8px; border-radius: 10px; }
.has-tenant .count-tag { background: rgba(255,255,255,0.2); color: white; }

/* ‡πÇ‡∏´‡∏°‡∏î‡∏Å‡∏∞‡∏û‡∏£‡∏¥‡∏ö‡∏ï‡∏≠‡∏ô‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á */
.moving-mode .room-card.is-vacant-room { border: 3px solid var(--c5) !important; animation: pulseGlow 1.2s infinite; }
@keyframes pulseGlow { 0% { transform: scale(1); } 50% { transform: scale(1.05); box-shadow: 0 0 15px var(--c5); } 100% { transform: scale(1); } }

/* --- Popup Modal (‡∏î‡∏µ‡πÑ‡∏ã‡∏ô‡πå‡πÉ‡∏´‡∏°‡πà‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏´‡∏•‡∏≤‡∏¢‡∏Ñ‡∏ô) --- */
#modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.7); display: none; justify-content: center; align-items: center; z-index: 5000; backdrop-filter: blur(8px); }
.modal-card { background: white; width: 95%; max-width: 500px; border-radius: 30px; padding: 25px; position: relative; animation: popUp 0.3s ease; max-height: 85vh; display: flex; flex-direction: column; }
@keyframes popUp { from{transform:scale(0.8); opacity:0} to{transform:scale(1); opacity:1} }
.close-modal { position: absolute; top: 15px; right: 20px; font-size: 28px; cursor: pointer; color: #ccc; }

.tenant-list-area { overflow-y: auto; padding-right: 5px; margin-top: 10px; }

/* Tenant Card (‡∏Ñ‡∏ô‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô‡∏à‡∏∞‡πÑ‡∏î‡πâ‡πÅ‡∏ö‡∏ö‡∏ô‡∏µ‡πâ‡πÄ‡∏´‡∏°‡∏∑‡∏≠‡∏ô‡∏Å‡∏±‡∏ô) */
.tenant-full-card { 
    background: #fcfcfc; border: 1px solid #eee; border-radius: 20px; 
    padding: 15px; margin-bottom: 15px; display: flex; flex-direction: column; gap: 12px;
}
.tenant-main-info { display: flex; align-items: center; gap: 15px; }
.profile-img-big { width: 70px; height: 70px; border-radius: 50%; object-fit: cover; border: 3px solid var(--c2); }
.info-text h4 { margin: 0; font-size: 17px; color: #333; }
.info-text p { margin: 3px 0; font-size: 13px; color: #777; }

/* ‡∏õ‡∏∏‡πà‡∏°‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏£‡∏≤‡∏¢‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏• (‡πÉ‡∏ô‡πÅ‡∏ï‡πà‡∏•‡∏∞‡∏Å‡∏≤‡∏£‡πå‡∏î) */
.tenant-actions { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 8px; }
.btn-sm { 
    border: none; padding: 8px; border-radius: 12px; font-size: 11px; font-weight: bold; 
    cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 4px;
}
.btn-view { background: var(--c2); color: #555; }
.btn-move { background: var(--c1); color: #555; }
.btn-del  { background: #ffebee; color: #c62828; }

/* ‡∏õ‡∏∏‡πà‡∏°‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà (‡∏õ‡∏∏‡πà‡∏°‡πÉ‡∏´‡∏ç‡πà‡∏î‡πâ‡∏≤‡∏ô‡∏•‡πà‡∏≤‡∏á) */
.btn-add-global { 
    background: var(--c4); color: #856404; border: none; padding: 14px; 
    border-radius: 18px; font-weight: bold; cursor: pointer; width: 100%; margin-top: 10px;
}
.room-tag { background: var(--c5); color: white; padding: 4px 12px; border-radius: 10px; font-size: 12px; font-weight: bold; display: inline-block; margin-bottom: 5px;}
</style>
</head>
<body>

<div id="move-banner">
    üîÑ ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏¢‡πâ‡∏≤‡∏¢ ‡∏Ñ‡∏∏‡∏ì <span id="moving-name"></span> | ‡πÇ‡∏õ‡∏£‡∏î‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á
    <button onclick="cancelMove()">‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å</button>
</div>

<div class="card">
    <h3 style="margin-top:0; color:var(--c5); border-bottom: 2px solid var(--c2); padding-bottom: 10px;">üè¢ ‡∏ú‡∏±‡∏á‡∏™‡∏ñ‡∏≤‡∏ô‡∏∞‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏Å‡∏≠‡∏≤‡∏®‡∏±‡∏¢</h3>
    <div id="roomRowsContainer"></div>
</div>

<!-- Modal -->
<div id="modal-overlay" onclick="closeModal(event)">
    <div class="modal-card" onclick="event.stopPropagation()">
        <span class="close-modal" onclick="closeModal()">&times;</span>
        <div id="modal-header"></div>
        <div class="tenant-list-area" id="modal-list-content"></div>
        <div id="modal-footer"></div>
    </div>
</div>

<script>
let roomData = [];
let movingJob = null;

// 1. ‡∏à‡∏≥‡∏•‡∏≠‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏• 50 ‡∏´‡πâ‡∏≠‡∏á
function init() {
    for(let f=1; f<=5; f++) {
        for(let r=1; r<=10; r++) {
            let id = f * 100 + r;
            let count = (id % 5 === 0) ? 0 : Math.floor(Math.random() * 3) + 1;
            let tenants = [];
            for(let i=0; i<count; i++) {
                tenants.push({
                    name: `‡∏Ñ‡∏∏‡∏ì‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤ ${i+1} ‡∏´‡πâ‡∏≠‡∏á ${id}`,
                    phone: `08x-xxx-x${id}${i}`,
                    date: "12 ‡∏ò.‡∏Ñ. 2024",
                    img: `https://i.pravatar.cc/150?u=${id}${i}`
                });
            }
            roomData.push({ id, floor: f, tenants });
        }
    }
    renderGrid();
}

// 2. ‡∏ß‡∏≤‡∏î‡∏ú‡∏±‡∏á‡∏´‡πâ‡∏≠‡∏á
function renderGrid() {
    const container = document.getElementById('roomRowsContainer');
    container.innerHTML = '';
    for(let f=1; f<=5; f++) {
        const row = document.createElement('div');
        row.className = 'floor-row';
        row.innerHTML = `<div class="floor-label">‡∏ä‡∏±‡πâ‡∏ô ${f}</div>`;
        const wrap = document.createElement('div');
        wrap.className = 'room-container';
        roomData.filter(r => r.floor === f).forEach(room => {
            const count = room.tenants.length;
            const isEmpty = count === 0;
            const card = document.createElement('div');
            card.className = `room-card ${isEmpty ? 'is-vacant-room' : 'has-tenant'}`;
            card.innerHTML = `
                <div style="font-size:20px">${isEmpty ? 'üë§' : (count > 1 ? 'üë•' : 'üë§')}</div>
                <b>${room.id}</b>
                <div class="count-tag">${isEmpty ? '‡∏ß‡πà‡∏≤‡∏á' : count + ' ‡∏Ñ‡∏ô'}</div>
            `;
            card.onclick = () => movingJob ? completeMove(room.id) : openRoomModal(room.id);
            wrap.appendChild(card);
        });
        row.appendChild(wrap);
        container.appendChild(row);
    }
}

// 3. ‡∏õ‡πä‡∏≠‡∏õ‡∏≠‡∏±‡∏û‡πÅ‡∏™‡∏î‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏Å‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏ô
function openRoomModal(id) {
    const room = roomData.find(r => r.id === id);
    const header = document.getElementById('modal-header');
    const list = document.getElementById('modal-list-content');
    const footer = document.getElementById('modal-footer');
    
    header.innerHTML = `<div class="room-tag">‡∏´‡πâ‡∏≠‡∏á ${room.id}</div><h2 style="margin:5px 0 15px;">‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏Å‡∏≠‡∏≤‡∏®‡∏±‡∏¢ (${room.tenants.length} ‡∏Ñ‡∏ô)</h2>`;
    
    let html = '';
    if (room.tenants.length > 0) {
        room.tenants.forEach((t, idx) => {
            html += `
                <div class="tenant-full-card">
                    <div class="tenant-main-info">
                        <img src="${t.img}" class="profile-img-big">
                        <div class="info-text">
                            <h4>${t.name}</h4>
                            <p>üìû ${t.phone}</p>
                            <p>üìÖ ‡πÄ‡∏Ç‡πâ‡∏≤‡∏û‡∏±‡∏Å: ${t.date}</p>
                        </div>
                    </div>
                    <div class="tenant-actions">
                        <button class="btn-sm btn-view" onclick="alert('‡∏î‡∏π‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏£‡∏≤‡∏¢‡∏Ñ‡∏ô')">üîç ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
                        <button class="btn-sm btn-move" onclick="startMove(${room.id}, ${idx})">üîÑ ‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á</button>
                        <button class="btn-sm btn-del" onclick="deleteTenant(${room.id}, ${idx})">üóëÔ∏è ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å</button>
                    </div>
                </div>`;
        });
    } else {
        html = '<div style="text-align:center; padding:40px; color:#ccc;">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏ú‡∏π‡πâ‡∏û‡∏±‡∏Å‡∏≠‡∏≤‡∏®‡∏±‡∏¢‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</div>';
    }
    
    list.innerHTML = html;
    footer.innerHTML = `<button class="btn-add-global" onclick="addTenant(${room.id})">‚ûï ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà‡∏•‡∏á‡πÉ‡∏ô‡∏´‡πâ‡∏≠‡∏á‡∏ô‡∏µ‡πâ</button>`;
    
    document.getElementById('modal-overlay').style.display = 'flex';
}

// 4. ‡∏£‡∏∞‡∏ö‡∏ö‡∏¢‡πâ‡∏≤‡∏¢‡∏´‡πâ‡∏≠‡∏á (‡∏£‡∏∞‡∏ö‡∏∏‡∏ï‡∏±‡∏ß‡∏ö‡∏∏‡∏Ñ‡∏Ñ‡∏•)
function startMove(roomId, tenantIdx) {
    const room = roomData.find(r => r.id === roomId);
    movingJob = { fromRoom: roomId, idx: tenantIdx, data: room.tenants[tenantIdx] };
    
    document.getElementById('modal-overlay').style.display = 'none';
    document.getElementById('move-banner').style.display = 'block';
    document.getElementById('moving-name').innerText = movingJob.data.name;
    document.body.classList.add('moving-mode');
}

function completeMove(targetId) {
    const target = roomData.find(r => r.id === targetId);
    // ‡πÄ‡∏á‡∏∑‡πà‡∏≠‡∏ô‡πÑ‡∏Ç: ‡∏¢‡πâ‡∏≤‡∏¢‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á‡∏´‡∏£‡∏∑‡∏≠‡∏´‡πâ‡∏≠‡∏á‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏Ñ‡∏ô‡∏≠‡∏¢‡∏π‡πà‡∏Å‡πá‡πÑ‡∏î‡πâ (‡∏ñ‡πâ‡∏≤‡πÇ‡∏Ñ‡∏ß‡∏ï‡∏≤‡πÑ‡∏°‡πà‡πÄ‡∏Å‡∏¥‡∏ô)
    if (target.tenants.length >= 3) return alert('‡∏´‡πâ‡∏≠‡∏á‡∏õ‡∏•‡∏≤‡∏¢‡∏ó‡∏≤‡∏á‡πÄ‡∏ï‡πá‡∏°‡πÅ‡∏•‡πâ‡∏ß (‡∏à‡∏≥‡∏Å‡∏±‡∏î 3 ‡∏Ñ‡∏ô)');

    // ‡∏•‡∏ö‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á‡πÄ‡∏Å‡πà‡∏≤
    roomData.find(r => r.id === movingJob.fromRoom).tenants.splice(movingJob.idx, 1);
    // ‡πÄ‡∏û‡∏¥‡πà‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà
    target.tenants.push(movingJob.data);

    cancelMove();
    renderGrid();
    alert('‡∏¢‡πâ‡∏≤‡∏¢‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à!');
}

function cancelMove() {
    movingJob = null;
    document.getElementById('move-banner').style.display = 'none';
    document.body.classList.remove('moving-mode');
}

// 5. ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•
function addTenant(id) {
    const name = prompt("‡∏ä‡∏∑‡πà‡∏≠‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡πÉ‡∏´‡∏°‡πà:");
    if(name) {
        roomData.find(r => r.id === id).tenants.push({
            name, phone: "08x-xxx-xxxx", date: "21 ‡∏ò.‡∏Ñ. 2024", img: `https://i.pravatar.cc/150?u=${Math.random()}`
        });
        renderGrid();
        openRoomModal(id);
    }
}

function deleteTenant(roomId, idx) {
    if(confirm('‡∏•‡∏ö‡∏ú‡∏π‡πâ‡πÄ‡∏ä‡πà‡∏≤‡∏Ñ‡∏ô‡∏ô‡∏µ‡πâ‡∏≠‡∏≠‡∏Å‡∏à‡∏≤‡∏Å‡∏´‡πâ‡∏≠‡∏á?')) {
        roomData.find(r => r.id === roomId).tenants.splice(idx, 1);
        renderGrid();
        openRoomModal(roomId);
    }
}

function closeModal() { document.getElementById('modal-overlay').style.display = 'none'; }

init();
</script>
</body>
</html>